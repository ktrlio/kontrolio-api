service: kontrolio-api

frameworkVersion: "2"

useDotenv: true

provider:
  name: aws
  runtime: go1.x
  lambdaHashingVersion: 20201221
  timeout: 2
  memorySize: 128
  stage: dev
  environment:
    ENV: production
    DB_USER: ${ssm:/kontrolio-db-user~true}
    DB_PASSWORD: ${ssm:/kontrolio-db-password~true}
    DB_NAME: ${ssm:/kontrolio-db-name~true}
    DB_HOST: ${ssm:/kontrolio-db-host~true}
    DB_PORT: ${ssm:/kontrolio-db-port~true}
    SENDER_EMAIL: ${ssm:/kontrolio-sender-email~true}
    ENABLE_EMAIL_AUTH: 0
    CLIENT_URL: https://kontrolio.com

package:
  individually: true

functions:
  createUser:
    handler: dist/create_user
    events:
      - httpApi:
          path: /user
          method: post
    package:
      exclude:
        - ./**
      include:
        - ./dist/create_user
  createRecord:
    handler: dist/create_record
    events:
      - httpApi:
          path: /record
          method: post
    package:
      exclude:
        - ./**
      include:
        - ./dist/create_record

plugins:
  - serverless-offline-ssm
  - serverless-offline

custom:
  serverless-offline:
    httpPort: 9000
  serverless-offline-ssm:
    stages:
      - offline
    file: .env
